<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>


<script>
    var colors = ['bVermell','bVerd','bBlau','bGroc'];
    var secuencia = [];
    var secuenciaUsuari = [];
    var marcador = [];
    var so = {
        bVermell: new Audio("https://s3.amazonaws.com/freecodecamp/simonSound1.mp3"),
        bVerd: new Audio("https://s3.amazonaws.com/freecodecamp/simonSound2.mp3"),
        bBlau: new Audio("https://s3.amazonaws.com/freecodecamp/simonSound3.mp3"),
        bGroc: new Audio("https://s3.amazonaws.com/freecodecamp/simonSound4.mp3")
    };
    var SetT = 1000;
    var torn = 1;
    var clics = 0;
    var tornSimon = true;


    function Boto(valor) {
        this.valor = valor;
        this.opacitar = () => {
            document.querySelector(this.valor).style.opacity = "0.4";
        }
        this.aclarar = () => {
            document.querySelector(this.valor).style.opacity = "1";
        }
        this.afegirEventsBoto = function (){

            document.querySelector(this.valor).addEventListener('mouseover',this.opacitar);
            document.querySelector(this.valor).addEventListener('mouseout',this.aclarar);
            document.querySelector(this.valor).addEventListener('click', function (){
                if(!tornSimon){
                    console.log("Entra Listener");
                    so[this.id].play();
                    clics++;
                    Usuari(this.id);
                }
            });
        }
    }
    function Usuari(idColor) {

        secuenciaUsuari.push(idColor);

        for (var i = 0; i < secuenciaUsuari.length; i++) {
            if(secuencia[i] === secuenciaUsuari[i]){

            }else if(secuencia[i] !== secuenciaUsuari[i]){
                Jugar();
                alert("Has fallat");
            }
        }
        if(clics === secuencia.length){
            tornSimon = true;
            TornJugador();
            secuenciaUsuari.splice(0,secuenciaUsuari.length);
            clics = 0;
            torn++;
            setTimeout(Simon,800);
        }
    }
    function ReinicarPartida() {

        clics = 0;
        torn = 1;
        secuencia.splice(0,secuencia.length);
        secuenciaUsuari.splice(0,secuenciaUsuari.length);

    }
    function Simon() {
        secuencia.push(colors[Math.floor(Math.random() * colors.length)]);
        ContadorRonda();
        var index = 0;
        opacitarSeguent();
        function opacitarSeguent() {
            if(index < secuencia.length){
                document.querySelector('#' + secuencia[index]).style.opacity = "0.2";
                so[secuencia[index]].play();
                setTimeout(function (){
                    document.querySelector('#' + secuencia[index]).style.opacity = "1";
                    index++;
                    setTimeout(opacitarSeguent,SetT);
                },SetT);
            }
            if(index === secuencia.length){
                tornSimon = false;
                TornJugador();
            }
        }
    }



    function Partida(){
        this.botons = [];
        this.dificultat = function (){

            var elegirDificultat  = prompt(`Elegueix dificultat
            1.Bàsic
            2.Mitjà
            3.Difícil`);

            if(parseInt(elegirDificultat) === 1){
                SetT = 2000;
            }else if(parseInt(elegirDificultat) === 2){
                SetT = 100;
            }else if(parseInt(elegirDificultat) === 3){
                SetT = 500;
            }
        }
        this.init = function (){

            this.pintar();

            for (var i = 0; i < 4; i++) {

                var boto = new Boto("#" + colors[i]);
                this.botons.push(boto);
                this.botons[i].afegirEventsBoto();
            }
            if(torn)
            this.dificultat();
            TornJugador();
            ContadorRonda();
        }
        this.pintar = function (){

            document.querySelector("body").innerHTML = '<div id="contenidor"></div>';
            document.querySelector("body").innerHTML += '<div id="marcador" hidden></div>';

            var contenidor = document.querySelector("#contenidor");

            contenidor.innerHTML += '<h1 id="jugador"></h1>';
            contenidor.innerHTML += '<h1 id="contador"></h1>;'
            for (var i = 0; i < colors.length; i++) {
                contenidor.innerHTML += `<button type="button" class="cuadre" id="${colors[i]}"></button>`;
            }
            contenidor.innerHTML += '<button type="button" id="boto" onclick="Jugar()">Jugar</button>';

        }
    }
    function MarcadorForm() {

        this.form = function (){

            document.querySelector("#taula").innerHTML += '<tr></tr>';

        }
        this.pintar = function (){

            document.querySelector("#marcador").innerHTML = '<h1>Marcador</h1>';
            document.querySelector("#marcador").innerHTML += '<table id="taula"></table>';
            document.querySelector("#taula").innerHTML += '<button type="button" id="boto" onclick="Jugar()">Enviar</button>';
            document.querySelector("#taula").innerHTML += '<button type="button" id="boto" onclick="Jugar()">Jugar</button>';

        }
        
    }
    function ContadorRonda(){
        document.querySelector("#contador").textContent = torn;
    }
    function TornJugador() {

        if(tornSimon){

            document.querySelector("#jugador").textContent = "Simon";
        }else {
            document.querySelector("#jugador").textContent = "Jugador";
        }
    }
    function Init() {
        partida = new Partida();
        partida.init();
        marcador = new MarcadorForm();
        marcador.pintar();
    }
    function Jugar(){
        document.querySelector("#marcador").hidden = true;
        ReinicarPartida();
        Simon();
    }
    Init();
   </script>
</body>
</html>